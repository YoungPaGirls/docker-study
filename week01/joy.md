# 01. 도커의 기초

## 1-1. 도커란 무엇인가

> 도커(docker): dockerd + dockerd 조작을 위한 CLI 로 구성되는 프로덕트   
> *dockerd: 컨테이너형 가상화 기술을 구현하기 위한 상주 애플리케이션(데몬)

### 도커의 특징

- 애플리케이션 배포에 특화되어 있다.
- 로컬에 환경을 구축할 때, 간단한 구성 파일(Dokcerfile)과 명령어 한 줄로 빠르게 운영 환경과 동일하게 구축이 가능하다.
- 가상화 소프트웨어와 비교해 오버헤드가 적어진다.

### 도커의 이점

- 간편한 조작
- 경량 컨테이너
- 운영 환경 배포 및 애플리케이션 플랫폼에도 이용 가능
- 뛰어난 이식성

### 기타 활용

- 설치가 번거로운 명령형 도구를 컨테이너로 공유
- 의존 라이브러리 도구를 컨테이너에 포함 시키기 → 스크립트의 동작 재현성 높임
- 도커 컨테이너 HTTP 부하 테스트 워커로 사용 → 요청 수 증가

## 1-2. 도커의 기본 개념

### 도커는 컨테이너형 가상화 기술을 사용한다.

- 컨테이너형 가상화 사용 시, 가상화 소프트웨어 없이 OS 리소스 격리 → 가상 OS 이용 가능 (컨테이너)
- 컨테이너 생성 시 발생하는 오버헤드는 다른 가상화 소프트웨어 보다 적음

cf. 호스트 운영 체제 가상화: OS 위에서 가상화 소프트웨어를 사용해 하드웨어를 에뮬레이션 하는 방법으로 게스트 OS를 만드는 방식
> 차이점을 이해하기 쉽게 내가 정리한 표  

| 구분           | 호스트 운영체제형 가상화               | 컨테이너형 가상화                  |
|--------------|-----------------------------|----------------------------|
| **운영 방식**    | 가상 머신(VM)을 생성하여 운영체제 포함     | 운영체제를 공유하며 컨테이너를 생성        |
| **구성 요소**    | 하이퍼바이저, 게스트 OS, 애플리케이션      | 컨테이너 엔진(Docker 등), 애플리케이션  |
| **운영체제 독립성** | 각 VM이 독립된 OS 사용             | 컨테이너가 호스트 OS를 공유           |
| **리소스 사용량**  | 운영체제마다 메모리, CPU 추가 소모       | 가볍고 리소스 소모가 적음             |
| **속도**       | 비교적 느림                      | 가볍고 빠름                     |
| **보안성**      | VM 간 강력한 격리                 | 운영체제를 공유해 약간 더 취약할 수 있음    |
| **주요 기술**    | VMware, VirtualBox, Hyper-V | Docker, Kubernetes, Podman |
| **사용 사례**    | 다양한 OS 환경 제공이 필요한 경우        | 경량화된 애플리케이션 배포 및 실행        |
| **비유**       | 각자 집(운영체제와 시설)이 있는 아파트      | 방을 공유하는 쉐어하우스              |

### 애플리케이션이 중심이 되는 도커   
- 도커와 LXC의 차이점  
    - 호스트 운영 체제의 영향 받지 않는 실행 환경  
    - DSL(Dockerfile)을 이용한 컨테이너 구성 & 배포 정의 
    - 이미지 버전 관리 
    - 이미지 포맷이 레이어 구조를 가져서 차분 빌드 가능  
    - 도커 레지스트리가 이미지 저장 서버 역할 담당   
    - 다양한 기능의 API  

cf. 차분 빌드(Differential Build): 기존에 만들어진 이미지의 변경된 부분만 다시 빌드하는 방식  (캐시 이용)

## 1-3. 도커 스타일 체험하기  

### 도커 이미지 빌드  
> Dockerfile 또는 애플리케이션 실행 파일을 이용해 도커 컨테이너의 원형이 될 이미지를 만드는 과정  

a. Dockerfile 작성 (이미지 생성 및 실행 내용 정의)  
  - FROM 절: 원형 역할의 도커 이미지 정의 (OS)  
  - COPY 절: 스크립트/애플리케이션 등 실행 타겟을 도커 컨테이너 안의 특정 위치로 복사하도록 정의  
  - RUN 절: 도커 컨테이너 안에서 명령 수행하기 위함  
  - CMD 절: 생성된 이미지를 도커 컨테이너로 실행하기 전에 먼저 실행할 명령 정의   
  - 예시
    ```
    FROM ubuntu: 16.04 
    
    COPY helloworld /usr/local/bin
    RUN chmod +× /us/local/bin/helloworld 
    
    CMD ["helloworld"]
    ```
b. 이미지 빌드
  - Dockerfile 이 있는 폴더에서 docker image build 명령  
  ```
  $ docker image build -t helloworld:latest .
  ```

c. 컨테이너 실행 
  - docker container run 명령으로 컨테이너 실행  
  ```
  $ docker container run helloworld:latest
  ```

## 1-4. 도커 사용 의의   
### 도커를 사용하는 의의  
- 멱등성(idempotency) 확보  
- 코드를 통한 실행 환경 구축 및 애플리케이션 구성  
- 이식성 향상 (실행 환경 & 애플리케이션 일체화)  
- 애플리케이션, 미들웨어 관리 용이성  

### 환경 차이로 인한 문제 방지  
> 인프라의 가변성(mutable infrastructure) 허용으로 서로 다른 서버에서 애플리케이션이 기대와 다르게 동작할 수 있다.  
> 해결안으로 코드로 관리하는 인프라 & 불변 인프라 개념이 제시 되었음  

- 코드로 관리하는 인프라(infrastructure as Code)
  - 코드 기반으로 인프라 정의  
  - 프로비저닝 도구로 서버 구축 → 멱등성 보장을 위한 관리로 업무 부담   
- 불변 인프라(Immutable Infrastructure)
  - 코드로 관리하는 인프라의 대책으로 제시된 개념  
  - 어떤 시점의 서버 상태를 저장해 복제할 수 있게 하자는 개념  
  - 서버 변경을 원하는 경우, 새로운 서버를 구축하여 이미지 저장 후 복제 (수정 X)  

도커를 사용하면 두 개념을 낮은 비용으로 실현 가능  
Dockerfile(코드로 관리하는 인프라) + 도커 이미지로 서버 구성 관리 (불변 인프라) 

### 애플리케이션 & 인프라 동시 관리  
> 도커 이미지 빌드는 인프라와 애플리케이션을 함께 묶는 과정.  
> 작업 환경 차이 감소  

### 도커 컨테이너 오케스트레이션 시스템  
> 도커 컴포즈(Docker Compose): 여러 컨테이너를 사용하는 애플리케이션을 쉽게 관리할 수 있는 도구  
- 도커 컴포즈를 이용해 yaml 파일에 컨테이너 정의, 컨테이너간 의존 관계 제어 가능 
- 도커 스웜(Docker Swarm)
  - 여러 서버에 걸쳐 있는 컨테이너를 관리할 수 있도록 한 도구  
  - 컨테이너 증가, 감소 / 컨테이너 배치, 로드밸런싱 등 기능 가짐  
  - 배포 시 롤링 업데이트 가능 (단계적 서비스 교체) 
- 컨테이너 오케스트레이션(container orchestration) 여러 서버에 걸쳐 있는 여러 컨테이너를 관리하는 기법  
  - 대표적으로 쿠버네티스(Kubernetes) 가 있음 (확장성 높고, 기능 충실). 


 
